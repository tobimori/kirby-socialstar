(function(){"use strict";function d(){return window.panel}const s=window.Vue;s.computed,s.customRef,s.defineAsyncComponent,s.defineComponent,s.effectScope,s.getCurrentInstance,s.getCurrentScope,s.h,s.inject,s.isProxy,s.isReactive,s.isReadonly,s.isRef,s.isShallow,s.markRaw,s.nextTick,s.onActivated,s.onBeforeMount,s.onBeforeUnmount,s.onBeforeUpdate,s.onDeactivated,s.onErrorCaptured,s.onMounted,s.onRenderTracked,s.onRenderTriggered,s.onScopeDispose,s.onServerPrefetch,s.onUnmounted,s.onUpdated,s.provide,s.proxyRefs,s.reactive,s.readonly;const p=s.ref;s.shallowReactive,s.shallowReadonly,s.shallowRef,s.toRaw,s.toRef,s.toRefs,s.triggerRef,s.unref,s.useAttrs,s.useCssModule,s.useCssVars,s.useListeners,s.useSlots,s.watch,s.watchEffect,s.watchPostEffect,s.watchSyncEffect;const u={name:[Number,String]};function c(a,e,t,n,o,i,m,l){var r=typeof a=="function"?a.options:a;return e&&(r.render=e,r.staticRenderFns=t,r._compiled=!0),{exports:a,options:r}}const v={__name:"ConnectorBase",props:{hasAuthCredentials:Boolean,isConnected:Boolean,service:String,currentPage:{type:Number,default:null},totalPages:Number,...u},emits:["connect","disconnect","refresh"],setup(a,{emit:e}){return{__sfc:!0,props:a,emit:e}}};var h=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return e.isConnected?t("k-field",{attrs:{label:e.$t(`socialstar.${e.service}.account`)}},[t("div",{staticClass:"star-account"},[e._t("default"),t("div",{staticClass:"star-account_actions"},[t("k-button",{attrs:{size:"sm",theme:"green",variant:"filled",icon:e.currentPage?"loader":"download",disabled:!!e.currentPage},on:{click:function(o){return n.emit("refresh")}}},[e._v(" "+e._s(e.currentPage?e.$t("socialstar.loadingPage",{currentPage:e.currentPage,totalPages:e.totalPages}):e.$t("socialstar.loadNewPosts"))+" ")]),t("k-button",{attrs:{size:"sm",variant:"filled",theme:"error",icon:"logout"},on:{click:function(o){return n.emit("disconnect")}}},[e._v(" "+e._s(e.$t("socialstar.disconnect"))+" ")])],1)],2)]):t("k-field",e._b({staticClass:"star-connect-account",class:{"has-error":!e.hasAuthCredentials}},"k-field",n.props,!1),[t("div",{staticClass:"star-connect-account_wrapper"},[t("k-icon",{attrs:{type:e.service}}),e.hasAuthCredentials?t("span",[e._v(e._s(e.$t(`socialstar.${e.service}.connectAccount`)))]):t("span",[e._v(e._s(e.$t(`socialstar.${e.service}.missingApiCredentials`)))])],1),t("k-button",{attrs:{size:"sm",variant:"filled",icon:"check",theme:e.hasAuthCredentials?"pink":"error",disabled:!e.hasAuthCredentials},on:{click:function(o){return n.emit("connect")}}},[e._v(" "+e._s(e.$t("socialstar.connect"))+" ")])],1)},g=[],b=c(v,h,g);const f=b.exports,C={__name:"InstagramConnector",props:{hasAuthCredentials:Boolean,authUrl:String,userDetails:Object,...u},setup(a){const e=a,t=()=>{window.location.href=e.authUrl},n=d(),o=p(!1);return{__sfc:!0,props:e,openAuthUrl:t,panel:n,isLoading:o,loadNewPosts:()=>{o.value=!0,n.api.get(`${n.view.path}/fields/${e.name}/update`).then(()=>{o.value=!1,n.reload()})},disconnect:()=>{n.dialog.open({component:"k-remove-dialog",props:{text:n.t("socialstar.instagram.disconnectConfirm")},on:{submit:()=>{n.api.get(`${n.view.path}/fields/${e.name}/remove-auth`).then(()=>{n.reload()}),n.dialog.close()}}})},name:u,ConnectorBase:f}}};var $=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t(n.ConnectorBase,{attrs:{service:"instagram",isConnected:!!e.userDetails,hasAuthCredentials:e.hasAuthCredentials,isLoading:n.isLoading},on:{connect:n.openAuthUrl,disconnect:n.disconnect,refresh:n.loadNewPosts}},[e.userDetails?[t("img",{staticClass:"star-instagram_avatar",attrs:{src:e.userDetails.profile_picture_url}}),t("div",{staticClass:"star-instagram_content"},[t("a",{staticClass:"star-instagram_name",attrs:{href:`https://instagram.com/${e.userDetails.username}`,target:"_blank"}},[t("span",[e._v(e._s(e.userDetails.name))]),t("strong",[e._v("@"+e._s(e.userDetails.username))])]),t("ul",[t("li",[t("k-icon",{attrs:{type:"images"}}),e._v(" "+e._s(e.$t("socialstar.instagram.posts",{count:e.userDetails.media_count}))+" ")],1),t("li",[t("k-icon",{attrs:{type:"users"}}),e._v(" "+e._s(e.$t("socialstar.instagram.followers",{count:e.userDetails.followers_count}))+" ")],1),t("li",[t("k-icon",{attrs:{type:"star-outline"}}),e._v(" "+e._s(e.$t("socialstar.instagram.follows",{count:e.userDetails.follows_count}))+" ")],1)])])]:e._e()],2)},w=[],y=c(C,$,w);const k=y.exports,P={__name:"YouTubeConnector",props:{hasAuthCredentials:Boolean,userDetails:Object,...u},setup(a){const e=a;console.log(e.userDetails);const t=d(),n=()=>{t.dialog.open({component:"k-form-dialog",props:{fields:{username:{label:t.t("socialstar.youtube.connectUser"),before:"@",required:!0,type:"text"}}},on:{submit:l=>{t.api.post(`${t.view.path}/fields/${e.name}/connect`,l).then(()=>{t.reload()}),t.dialog.close()}}})},o=()=>{t.dialog.open({component:"k-remove-dialog",props:{text:t.t("socialstar.youtube.disconnectConfirm")},on:{submit:()=>{t.api.post(`${t.view.path}/fields/${e.name}/disconnect`).then(()=>{t.reload()}),t.dialog.close()}}})},i=p(null);return{__sfc:!0,props:e,panel:t,connect:n,disconnect:o,currentPage:i,refresh:async()=>{i.value=1;const l=[];let r=null;for(;r!==void 0;){r&&l.push(r);try{const _=await t.api.post(`${t.view.path}/fields/${e.name}/update`,{pageToken:r});i.value++,r=_.token??void 0}catch(_){t.notification.error(_.message)}}await t.api.post(`${t.view.path}/fields/${e.name}/cleanup`,{pageTokens:l}),i.value=null,t.reload()},ConnectorBase:f}}};var D=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t(n.ConnectorBase,{attrs:{service:"youtube",isConnected:!!e.userDetails,hasAuthCredentials:e.hasAuthCredentials,currentPage:n.currentPage,totalPages:e.userDetails?Math.ceil(e.userDetails.statistics.videoCount/20):0},on:{connect:n.connect,disconnect:n.disconnect,refresh:n.refresh}},[e.userDetails?[t("img",{staticClass:"star-instagram_avatar",attrs:{src:e.userDetails.snippet.thumbnails.high.url}}),t("div",{staticClass:"star-instagram_content"},[t("a",{staticClass:"star-instagram_name",attrs:{href:`https://youtube.com/${e.userDetails.snippet.customUrl}`,target:"_blank"}},[t("span",[e._v(e._s(e.userDetails.snippet.title))]),t("strong",[e._v(e._s(e.userDetails.snippet.customUrl))])]),t("ul",[t("li",[t("k-icon",{attrs:{type:"youtube"}}),e._v(" "+e._s(e.$t("socialstar.youtube.videoCount",{count:e.userDetails.statistics.videoCount}))+" ")],1),t("li",[t("k-icon",{attrs:{type:"users"}}),e._v(" "+e._s(e.$t("socialstar.youtube.subscriberCount",{count:e.userDetails.statistics.subscriberCount}))+" ")],1)])])]:e._e()],2)},R=[],A=c(P,D,R);const x=A.exports,S={__name:"YouTubeEmbed",props:{label:String,value:String},setup(a){return{__sfc:!0,props:a}}};var B=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t("k-field",e._b({},"k-field",n.props,!1),[t("div",{staticClass:"star-youtube-embed"},[t("iframe",{attrs:{src:`https://www.youtube-nocookie.com/embed/${e.value}`,frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}})])])},U=[],T=c(S,B,U);const N=T.exports,F={__name:"Refresh",setup(a){return{__sfc:!0}}};var L=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("k-button",{attrs:{disabled:e.isLoading,icon:e.isLoading?"loader":"refresh",variant:"filled"},on:{click:e.reload}},[e._v(" "+e._s(e.$t("socialstar.refresh"))+" ")])},I=[],M=c(F,L,I);const j=M.exports;panel.plugin("tobimori/socialstar",{fields:{"socialstar-instagram-connector":k,"socialstar-youtube-connector":x,"socialstar-youtube-embed":N},viewButtons:{"socialstar-refresh":j}})})();
